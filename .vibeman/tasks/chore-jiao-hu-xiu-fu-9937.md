---
id: chore-jiao-hu-xiu-fu-9937
title: 交互修复1
type: chore
status: review
tags: []
priority: medium
created_at: '2026-02-24T23:41:52.222Z'
updated_at: '2026-02-25T05:45:50.049Z'
---

## Goal

通过精简结果展示并强化就地交互，让用户在同一视图内快速理解问题并复制修正结果，减少来回切换和操作成本。最终用户应能在“格式化输出”区域完成查看问题说明与复制文本的主要操作。

## Context

当前任务仅记录两条简述需求（移除“问题明细”区块、为格式化输出添加一键复制），未定义验收标准、边界场景、失败反馈或测试方式。  
仓库当前仅包含 `.vibeman/tasks/*.md` 任务文档与 `.vibeman/vibeman.db`，未发现前端实现代码目录（如 `src/`、`app/`）及测试工程文件，因此具体组件路径和命令尚未在仓库内固化。  
关联需求来源：`feature-chuang-jian-yi-4449` 已定义“问题高亮可追溯规则信息”，本任务是对该交互形态的细化与收敛。

## Requirements

- [ ] 页面中不再显示独立的“问题明细”section；问题说明仅通过“格式化输出”中的问题高亮进行承载。
- [ ] 鼠标悬浮在任一问题高亮片段上时，能在 300ms 内看到对应问题说明（至少包含规则名/问题类型与说明文本）；移出高亮后提示可关闭且不残留。
- [ ] 同一时刻仅展示一个问题提示层；相邻或重叠高亮不会出现提示内容错位、闪烁或遮挡导致不可读。
- [ ] “格式化输出”section提供一键复制入口，点击后复制的是“当前格式化结果纯文本”，并完整保留换行与空格。
- [ ] 复制操作具备可见反馈（成功/失败），失败时不会清空或修改当前格式化结果内容。
- [ ] 当格式化输出为空时，复制入口不可用或点击后给出明确不可复制反馈，不抛出未处理异常。
- [ ] 键盘可访问性满足基础要求：复制按钮可通过 Tab 聚焦并用 Enter/Space 触发；高亮信息对屏幕阅读器至少具备可读文本关联（如 `aria-describedby` 或等效语义）。
- [ ] 关键交互存在可重复验证用例：至少覆盖“有问题文本悬浮提示”“无问题文本无提示”“复制成功”“复制失败/无权限”“空输出不可复制”五类场景。

## Implementation Notes

- 目标范围：格式化输出区域、问题高亮渲染层、复制按钮与反馈提示层；“问题明细”独立区块不再作为主交互入口。
- 数据契约：高亮片段与问题说明一一映射，至少包含唯一标识、文本区间、问题类型、说明文案。
- 交互语义：悬浮提示定位跟随高亮片段，复制内容来源于格式化后的最终字符串而非 HTML 片段。
- 边界场景：多行文本、高亮跨行、连续高亮片段、超长文本（滚动容器内提示定位）、剪贴板权限拒绝、无输出状态。
- 主要风险：高亮区间与提示映射错位、滚动容器内 tooltip 定位抖动、Clipboard API 在不同浏览器权限策略下行为不一致。
- 验证方式：单元测试覆盖高亮映射与复制逻辑；集成/E2E 覆盖 hover 与复制反馈流程；手工回归覆盖桌面端与移动端（移动端需确认 hover 的降级策略）。
- 非目标：新增规则引擎能力、问题导出功能、批量修复流程改造、页面整体布局重设计。

## Recommended Steps

- Step 1: 交互契约与状态模型收敛
  - [ ] 定义“高亮片段 -> 问题说明”数据结构与 UI 状态（active highlight、tooltip visibility、copy status）。
  - [ ] 明确并落地“问题明细”section下线后的页面信息架构，确保问题说明仅从高亮入口访问。
  - [ ] 梳理空输出、无问题、剪贴板拒绝权限三类状态机，统一反馈文案与展示优先级。
- Step 2: 高亮悬浮提示实现
  - [ ] 在格式化输出高亮节点上接入 hover/focus 触发提示层，并保证提示内容与高亮唯一映射。
  - [ ] 处理滚动容器与多行高亮的提示定位，避免遮挡主文本与边界裁切。
  - [ ] 增加互斥显示机制，确保同一时间仅一个提示层可见并可稳定关闭。
- Step 3: 一键复制与反馈闭环
  - [ ] 在格式化输出section增加复制按钮，接入 Clipboard API 并复制格式化纯文本。
  - [ ] 实现复制成功/失败反馈及空输出禁用态，避免异常冒泡到用户界面。
  - [ ] 补充键盘触发与基础无障碍语义，保证复制按钮与高亮说明可被辅助技术识别。
- Step 4: 验证与回归
  - [ ] 编写并通过单元测试：高亮映射、tooltip互斥、复制逻辑、空输出分支。
  - [ ] 编写并通过集成/E2E：hover显示说明、复制成功、复制失败、无问题文本行为。
  - [ ] 执行跨浏览器手工回归并记录结果（至少 Chrome/Safari 最新稳定版），确认移动端交互降级策略符合预期。

## Open Questions

- Question: Tooltip 中“具体问题”的展示粒度是否仅需规则名+简述，还是要包含“原文/建议修复”明细？
  - Answer: [Pending]
- Question: 移动端无 hover 场景是否要求使用 tap 打开同等说明，并与桌面端共用同一套内容？
  - Answer: [Pending]
- Question: 一键复制是否需要复制“仅修正后文本”，还是包含行号/标记等辅助信息？
  - Answer: [Pending]

## Implementation Summary

[Auto-generated after completion: what changed + tests run.]
