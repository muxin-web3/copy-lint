---
id: chore-jiao-hu-xiu-fu-9937
title: 交互修复
type: chore
status: review
tags: []
priority: medium
created_at: '2026-02-24T23:41:52.222Z'
updated_at: '2026-02-24T23:50:29.070Z'
---

## Goal

将“问题明细”从独立区块收敛到格式化输出中的就地交互，减少用户在不同区域来回切换的认知成本。用户在输出区即可完成“查看问题说明 + 复制结果”的主要流程。

## Context

当前任务文件仅包含两条简述性需求，尚未定义可验证的完成标准、边界场景与测试口径。  
同仓库任务 `.vibeman/tasks/feature-chuang-jian-yi-4449.md` 已定义输出区问题高亮能力，且 Open Questions 中已确认悬浮说明属于目标交互能力。  
当前仓库可见文件主要为 `.vibeman/tasks/*.md` 与 `.vibeman/vibeman.db`，未发现可直接定位的前端源码路径。

## Requirements

- [ ] 页面不再渲染独立“问题明细”区块（含标题、列表与占位态）；相关信息仅通过格式化输出区的问题高亮交互呈现。
- [ ] 每个问题高亮在桌面端支持鼠标悬浮显示说明，在键盘导航场景支持 `focus` 显示同等说明，说明内容与该高亮对应的问题一一匹配。
- [ ] 在移动端（无 hover）可通过点击高亮查看同等问题说明，不要求依赖鼠标事件才能读取问题信息。
- [ ] 多处高亮同时存在时，任一高亮触发的说明内容不串位、不复用错误，且切换高亮后说明内容及时更新。
- [ ] 格式化输出区提供一键复制入口，复制结果与当前展示的格式化文本完全一致（包含换行与空格），不混入提示文案或 UI 文本。
- [ ] 复制交互包含明确反馈：成功态可见、失败态可见；当输出为空时复制入口处于不可用或受限状态且行为可预期。
- [ ] 至少覆盖以下自动化验证：问题高亮说明触发逻辑、明细区块移除回归、复制成功与失败分支、空输出分支。

## Implementation Notes

- 目标代码范围（按既有任务约定）：`src/components/`（输出区、问题高亮、复制按钮）、`src/styles/`（高亮与提示样式）、`src/hooks/` 或 `src/utils/`（复制能力封装）。
- 交互语义：同一问题说明在 `hover/focus/tap` 三种触发路径下的一致性；键盘可达性与 `aria` 属性完整性。
- 复制能力：`navigator.clipboard` 可用分支与受限环境分支（权限拒绝、非安全上下文）并存。
- 验证命令口径（以项目最终脚本为准）：`npm run lint`、`npm run test`、`npm run build`、`npm run test:e2e`。
- 风险清单：高亮索引与说明映射错位、Tooltip 被容器裁剪、移动端触发冲突、复制失败无反馈导致误判。
- 非目标范围：规则引擎新增规则、文本修正规则变更、用户系统与后端能力扩展。

## Recommended Steps

- Step 1: 交互契约冻结
  - [ ] 盘点当前输出区与问题明细的数据来源，形成“高亮片段 -> 问题说明”唯一映射契约。
  - [ ] 明确桌面端与移动端的说明触发规则（hover/focus/tap）及关闭规则，避免多端行为分叉。
  - [ ] 固化复制入口在空输出、正常输出、复制失败三种状态下的 UI 与反馈文案。
- Step 2: 输出区交互重构
  - [ ] 移除独立问题明细区块及其渲染分支，保留或迁移必要信息到高亮交互层。
  - [ ] 在高亮元素上接入 Tooltip/Popover 说明显示，保证鼠标、键盘、触控路径均可访问。
  - [ ] 处理多高亮切换、快速悬浮切换与滚动容器场景，确保说明内容与目标高亮一致。
- Step 3: 一键复制能力接入
  - [ ] 在格式化输出区新增复制控件并绑定当前输出文本源，避免读取中间态或旧值。
  - [ ] 实现复制成功/失败反馈及失败兜底分支，确保用户可感知复制结果。
  - [ ] 处理空输出禁用态与样式状态，避免无效点击造成误导。
- Step 4: 回归验证与交付门禁
  - [ ] 补齐单元/集成测试：高亮说明触发、明细区移除、复制成功失败、空输出分支。
  - [ ] 执行 lint/test/build（及可用的 e2e）验证，无新增告警与失败用例。
  - [ ] 更新任务记录中的验收说明，确保后续 review 可按 Requirements 逐条勾选。

## Open Questions

- Question: 移动端点按高亮后的说明容器形态采用就地浮层还是底部固定说明栏？
  - Answer: [Pending]
- Question: 复制反馈形式采用轻提示（toast）还是按钮内联状态文案，是否需要自动消失时长？
  - Answer: [Pending]
- Question: 移除“问题明细”后，顶部问题总数统计是否保留为独立信息区？
  - Answer: [Pending]
- Question: 高亮点击行为若已用于“点击修复”，与“点击查看说明”的优先级如何定义？
  - Answer: [Pending]

## Implementation Summary

[Auto-generated after completion: what changed + tests run.]
